<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Validação de Visita ACS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h3>Validando localização...</h3>
<p id="status">Aguarde...</p>

<script>
navigator.geolocation.getCurrentPosition(
function(position) {

    var lat = position.coords.latitude;
    var lon = position.coords.longitude;
    var coordenadas = lat + "," + lon;

    fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=" 
          + lat + "&lon=" + lon)
    .then(response => response.json())
    .then(data => {

        var rua = "";

        if (data.address) {
            rua = data.address.road 
                || data.address.residential 
                || data.address.pedestrian 
                || data.address.suburb 
                || data.display_name;
        } else {
            rua = "Endereco nao identificado";
        }

        var url = "https://form.jotform.com/260504743750050"
            + "?locationCoordinates=" + encodeURIComponent(coordenadas)
            + "&ruaAuto=" + encodeURIComponent(rua);

        window.location.href = url;
    });

},
function(error) {
    document.getElementById("status").innerHTML =
        "Permita o acesso ao GPS para continuar.";
},
{
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 0
});
</script>

</body>
</html>
